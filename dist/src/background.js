chrome.runtime.onMessage.addListener(((e,t,r)=>{if("fetchItemInfo"===e.action)return fetch(e.url).then((e=>{if(!e.ok)throw new Error(`response status : ${e.status}`);return e.json()})).then((e=>{r({data:e})})).catch((e=>{r({error:e.msg})})),!0;if("fetchItem"===e.action){const a=10485760;return fetch(e.url).then((e=>e.blob())).then((async n=>{const o=Math.ceil(n.size/a);r({status:"start",totalChunks:o,totalSize:n.size,type:n.type});for(let r=0;r<o;r++){const s=r*a,i=Math.min(s+a,n.size),c=n.slice(s,i),d=new FileReader;await new Promise((a=>{d.onloadend=()=>{chrome.tabs.sendMessage(t.tab.id,{action:"receiveChunk",chunkIndex:r,totalChunks:o,dataUrl:d.result,progressBarId:e.progressBarId}),a()},d.readAsDataURL(c)}))}})).catch((r=>{chrome.tabs.sendMessage(t.tab.id,{action:"downloadError",downloadId:e.downloadId,error:r.toString()})})),!0}if("fetchThumbnail"===e.action)return fetch(e.url).then((e=>{if(!e.ok)throw new Error(`response status: ${e.status}`);return e.arrayBuffer()})).then((e=>{r({data:Array.from(new Uint8Array(e))})})).catch((e=>{r({error:e.msg,data:null})})),!0;"downloadZip"===e.action&&chrome.downloads.download({url:e.blobUrl,filename:e.filename,saveAs:!0},(e=>{chrome.runtime.lastError}))}));
//# sourceMappingURL=background.js.map
