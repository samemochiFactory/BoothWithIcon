document.addEventListener("DOMContentLoaded",async()=>{chrome.storage.local.get(["namingRules","includeIcon"],o=>{const e=o.namingRules||[];document.getElementById("namingRuleShopProduct").checked=e.includes("ã‚·ãƒ§ãƒƒãƒ—å"),document.getElementById("namingRuleProductName").checked=e.includes("å•†å“å"),document.getElementById("namingRuleFileName").checked=e.includes("ãƒ•ã‚¡ã‚¤ãƒ«å")}),document.querySelectorAll('input[type="checkbox"]').forEach(o=>{o.addEventListener("change",()=>{const e=[];document.getElementById("namingRuleShopProduct").checked&&e.push("ã‚·ãƒ§ãƒƒãƒ—å"),document.getElementById("namingRuleProductName").checked&&e.push("å•†å“å"),document.getElementById("namingRuleFileName").checked&&e.push("ãƒ•ã‚¡ã‚¤ãƒ«å"),chrome.storage.local.set({namingRules:e})})});const n=document.getElementById("selectedFolderName"),t=await g();n.textContent=t?`ðŸ“ ${t}`:"ï¼ˆæœªé¸æŠžï¼‰"});document.getElementById("applySettingsBtn").addEventListener("click",()=>{chrome.tabs.query({active:!0,currentWindow:!0},n=>{var t;(t=n[0])!=null&&t.id&&chrome.tabs.reload(n[0].id)})});let a=null;document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("folderPicker"),t=document.getElementById("selectedFolderName"),o=document.getElementById("fetchIconBtn");n.addEventListener("click",async()=>{try{a=await window.showDirectoryPicker(),t.textContent=`é¸æŠžã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€: ${a.name}`,o.disabled=!1}catch(e){e.name==="AbortError"?(console.log("ãƒ•ã‚©ãƒ«ãƒ€é¸æŠžãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ"),console.log(e)):(console.error("ãƒ•ã‚©ãƒ«ãƒ€é¸æŠžã‚¨ãƒ©ãƒ¼:",e),t.textContent="âŒ ãƒ•ã‚©ãƒ«ãƒ€é¸æŠžã«å¤±æ•—ã—ã¾ã—ãŸ",o.disabled=!0)}}),o.addEventListener("click",async()=>{const e=document.getElementById("shopUrl").value.trim();if(!e||!a){alert("URLã¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠžã—ã¦ãã ã•ã„");return}try{const r=await h(e),i=await w(r),s=await m("desktop.ini"),l=await m("setIcon.bat");await saveToFolder(a,"boothThumbnail.ico",i),await saveToFolder(a,"desktop.ini",new Blob([s],{type:"text/plain"})),await saveToFolder(a,"setIcon.bat",new Blob([l],{type:"text/plain"})),alert("ãƒ•ã‚©ãƒ«ãƒ€ã«3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼")}catch(r){console.error("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼:",r),alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}})});async function m(n){const t=chrome.runtime.getURL(`static/${n}`),o=await fetch(t);if(!o.ok)throw new Error(`${n} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ`);return await o.text()}async function g(){const n=await chrome.storage.local.get("folderHandle");if(!n.folderHandle)return null;try{return(await window.showDirectoryPicker({startIn:n.folderHandle})).name}catch{return null}}async function h(n){return new Promise((t,o)=>{chrome.runtime.sendMessage({action:"fetchThumbnail",url:n},e=>{if(e&&e.data){const r=new Uint8Array(e.data),i=new Blob([r]);t(i)}else o(new Error("å•†å“ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"))})})}async function w(n){try{const t=document.createElement("canvas"),o=t.getContext("2d"),e=256;t.width=e,t.height=e,await new Promise((l,d)=>{const c=new Image;c.onload=()=>{o.drawImage(c,0,0,e,e),URL.revokeObjectURL(c.src),l()},c.onerror=u=>d(new Error(`failed to load thumbnail : ${u}`)),c.src=URL.createObjectURL(n)});const r=await new Promise((l,d)=>{t.toBlob(c=>{c?l(c):d(new Error("failed to generate PNG blob"))},"image/png")});return await new PngIcoConverter().convertToBlobAsync([{png:r}])}catch(t){throw console.error("failed to converting .ico : ",t),t}}
//# sourceMappingURL=popup.js.map
