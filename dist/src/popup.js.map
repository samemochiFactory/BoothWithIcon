{"version":3,"file":"popup.js","sources":["../../src/popup.js"],"sourcesContent":["// console.log(\"Popup loaded!\");\r\n// import { fetchThumbnail } from './FetchBlobModule';\r\n// import { convertPngToIcon } from './FetchBlobModule';\r\n\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    // Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„ÇÄ\r\n    chrome.storage.local.get(['namingRules', 'includeIcon'], (result) => {\r\n        const namingRules = result.namingRules || [];\r\n        // const includeIcon = result.includeIcon ?? true;\r\n\r\n        document.getElementById('namingRuleShopProduct').checked = namingRules.includes('„Ç∑„Éß„ÉÉ„ÉóÂêç');\r\n        document.getElementById('namingRuleProductName').checked = namingRules.includes('ÂïÜÂìÅÂêç');\r\n        document.getElementById('namingRuleFileName').checked = namingRules.includes('„Éï„Ç°„Ç§„É´Âêç');\r\n        // document.getElementById('includeIcon').checked = includeIcon;\r\n    });\r\n\r\n    // Â§âÊõ¥„Ç§„Éô„É≥„Éà„Åß‰øùÂ≠ò\r\n    document.querySelectorAll('input[type=\"checkbox\"]').forEach(checkbox => {\r\n        checkbox.addEventListener('change', () => {\r\n            const namingRules = [];\r\n            if (document.getElementById('namingRuleShopProduct').checked) namingRules.push('„Ç∑„Éß„ÉÉ„ÉóÂêç');\r\n            if (document.getElementById('namingRuleProductName').checked) namingRules.push('ÂïÜÂìÅÂêç');\r\n            if (document.getElementById('namingRuleFileName').checked) namingRules.push('„Éï„Ç°„Ç§„É´Âêç');\r\n            // const includeIcon = document.getElementById('includeIcon').checked;\r\n\r\n            chrome.storage.local.set({\r\n                namingRules\r\n                // ,\r\n                // includeIcon\r\n            });\r\n        });\r\n    });\r\n    // „Éï„Ç©„É´„ÉÄÂêçË°®Á§∫\r\n    const folderDisplay = document.getElementById('selectedFolderName');\r\n    const handleIdbKey = 'folderHandle'; // ‰øùÂ≠ò„Ç≠„Éº\r\n\r\n    const folderName = await getFolderNameFromStorage();\r\n    folderDisplay.textContent = folderName ? `üìÅ ${folderName}` : 'ÔºàÊú™ÈÅ∏ÊäûÔºâ';\r\n});\r\ndocument.getElementById('applySettingsBtn').addEventListener('click', () => {\r\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n        if (tabs[0]?.id) {\r\n            chrome.tabs.reload(tabs[0].id); // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Éñ„Çí„É™„É≠„Éº„Éâ\r\n        }\r\n    });\r\n});\r\n\r\nlet selectedDirectoryHandle = null;\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    const folderPickerBtn = document.getElementById('folderPicker');\r\n    const folderNameDisplay = document.getElementById('selectedFolderName');\r\n    const fetchIconBtn = document.getElementById('fetchIconBtn');\r\n\r\n    folderPickerBtn.addEventListener('click', async () => {\r\n        try {\r\n            // showDirectoryPicker „ÅØ File System Access APIÔºàÊñ∞„Åó„ÅÑAPIÔºâ\r\n            selectedDirectoryHandle = await window.showDirectoryPicker();\r\n\r\n            // „Éï„Ç©„É´„ÉÄÂêç„ÇíÁîªÈù¢„Å´Ë°®Á§∫\r\n            folderNameDisplay.textContent = `ÈÅ∏Êäû„Åï„Çå„Åü„Éï„Ç©„É´„ÉÄ: ${selectedDirectoryHandle.name}`;\r\n\r\n            // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ\r\n            fetchIconBtn.disabled = false;\r\n\r\n        } catch (err) {\r\n            if (err.name === 'AbortError') {\r\n                console.log(\"„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü\");\r\n                console.log(err);\r\n            } else {\r\n                console.error(\"„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Ç®„É©„Éº:\", err);\r\n                folderNameDisplay.textContent = '‚ùå „Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';\r\n                fetchIconBtn.disabled = true;\r\n            }\r\n        }\r\n    });\r\n\r\n    //fetchIconBtn „ÅÆ„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜ\r\n    fetchIconBtn.addEventListener('click', async () => {\r\n        const urlInput = document.getElementById('shopUrl').value.trim();\r\n        if (!urlInput || !selectedDirectoryHandle) {\r\n            alert(\"URL„Å®„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ\");\r\n            return;\r\n        }\r\n        try {\r\n            const thumbnailBlob = await fetchThumbnail(urlInput);\r\n            const icoBlob = await convertPngToIcon(thumbnailBlob);\r\n\r\n            const desktopIniContent = await loadLocalFile('desktop.ini');\r\n            const batContent = await loadLocalFile('setIcon.bat');\r\n\r\n            await saveToFolder(selectedDirectoryHandle, \"boothThumbnail.ico\", icoBlob);\r\n            await saveToFolder(selectedDirectoryHandle, \"desktop.ini\", new Blob([desktopIniContent], { type: 'text/plain' }));\r\n            await saveToFolder(selectedDirectoryHandle, \"setIcon.bat\", new Blob([batContent], { type: 'text/plain' }));\r\n\r\n            alert(\"„Éï„Ç©„É´„ÉÄ„Å´3„Éï„Ç°„Ç§„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ\");\r\n        } catch (err) {\r\n            console.error(\"‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº:\", err);\r\n            alert(\"‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü\");\r\n        }\r\n    });\r\n});\r\n\r\nasync function loadLocalFile(filename) {\r\n    const url = chrome.runtime.getURL(`static/${filename}`);\r\n    const response = await fetch(url);\r\n    if (!response.ok) throw new Error(`${filename} „ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü`);\r\n    return await response.text();\r\n}\r\n\r\nasync function getFolderNameFromStorage() {\r\n    const stored = await chrome.storage.local.get('folderHandle');\r\n    if (!stored.folderHandle) return null;\r\n\r\n    try {\r\n        const handle = await window.showDirectoryPicker({ startIn: stored.folderHandle });\r\n        return handle.name;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nasync function fetchThumbnail(thumbnailUrl) {\r\n    return new Promise((resolve, reject) => {\r\n        chrome.runtime.sendMessage(\r\n            {\r\n                action: \"fetchThumbnail\",\r\n                url: thumbnailUrl\r\n            },\r\n            (response) => {\r\n                if (response && response.data) {\r\n                    // ArrayBuffer „ÇíÂèó„ÅëÂèñ„Å£„ÅüÂâçÊèê„Åß Blob „Å´Â§âÊèõ\r\n                    const byteArray = new Uint8Array(response.data);\r\n                    const blob = new Blob([byteArray]);\r\n                    resolve(blob);\r\n                } else {\r\n                    reject(new Error(\"ÂïÜÂìÅ„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü\"));\r\n                }\r\n            }\r\n        );\r\n    });\r\n}\r\n\r\nasync function convertPngToIcon(thumbnailBlob) {\r\n    try {\r\n        // PNGÁîªÂÉè„ÇíCanvas„Å´ÊèèÁîª\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        const size = 256; // ICOÊúÄÂ§ß„Çµ„Ç§„Ç∫\r\n        canvas.width = size;\r\n        canvas.height = size;\r\n\r\n        // ÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å®ÊèèÁîª„ÇíÂæÖÊ©ü\r\n        await new Promise((resolve, reject) => {\r\n            const img = new Image();\r\n            img.onload = () => {\r\n                ctx.drawImage(img, 0, 0, size, size);\r\n                // „É°„É¢„É™„É™„Éº„ÇØ„ÇíÈò≤Ê≠¢\r\n                URL.revokeObjectURL(img.src);\r\n                resolve();\r\n            };\r\n            img.onerror = (e) => reject(new Error(`failed to load thumbnail : ${e}`));\r\n            img.src = URL.createObjectURL(thumbnailBlob);\r\n        });\r\n\r\n        // Canvas„Åã„ÇâPNG Blob„ÇíÁîüÊàê\r\n        const pngBlob = await new Promise((resolve, reject) => {\r\n            canvas.toBlob((blob) => {\r\n                if (!blob) reject(new Error(\"failed to generate PNG blob\"));\r\n                else resolve(blob);\r\n            }, 'image/png');\r\n        });\r\n\r\n        // PNG Blob„ÇíICOÂΩ¢Âºè„Å´Â§âÊèõ\r\n        const converter = new PngIcoConverter();\r\n        const icoBlob = await converter.convertToBlobAsync([{ png: pngBlob }]);\r\n\r\n        return icoBlob;\r\n    } catch (error) {\r\n        console.error(\"failed to converting .ico : \", error);\r\n        throw error;\r\n    }\r\n}"],"names":["result","namingRules","checkbox","folderDisplay","folderName","getFolderNameFromStorage","tabs","_a","selectedDirectoryHandle","folderPickerBtn","folderNameDisplay","fetchIconBtn","err","urlInput","thumbnailBlob","fetchThumbnail","icoBlob","convertPngToIcon","desktopIniContent","loadLocalFile","batContent","filename","url","response","stored","thumbnailUrl","resolve","reject","byteArray","blob","canvas","ctx","size","img","e","pngBlob","error"],"mappings":"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"}