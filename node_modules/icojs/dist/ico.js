/*!
 * icojs v0.19.5
 * (c) egy186
 * https://github.com/egy186/icojs/blob/main/LICENSE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var r=t.ICO,n=t.ICO={};e(n),n.noConflict=function(){return t.ICO=r,n}}())}(this,(function(t){"use strict";var e="image/png",r={decode:function(t){return new Promise((function(e){var r=URL.createObjectURL(new Blob([t])),n=document.createElement("img");n.src=r,n.onload=function(){var t=n.naturalHeight,r=n.naturalWidth,i=document.createElement("canvas");i.width=r,i.height=t;var o=i.getContext("2d");o.drawImage(n,0,0);var a=o.getImageData(0,0,r,t).data;e({data:a,height:t,width:r})}}))},encode:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return new Promise((function(e){var n=t.data,i=t.height,o=t.width,a=document.createElement("canvas");a.width=o,a.height=i;for(var f=a.getContext("2d"),u=f.createImageData(o,i),c=u.data,h=0;h<c.length;h++)c[h]=n[h];f.putImageData(u,0,0),e(function(t){for(var e=atob(t.replace(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+,/,"")),r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r.buffer}(a.toDataURL(r)))}))}};var n,i,o,a,f,u,c,h,s,d,g=function(t){var e=function(t){if(t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray)return new DataView(t.buffer,t.byteOffset,t.byteLength);if(t instanceof ArrayBuffer)return new DataView(t);throw new TypeError("Expected `data` to be an ArrayBuffer, Buffer, Int8Array, Uint8Array or Uint8ClampedArray")}(t);return 0===e.getUint16(0,!0)&&1===e.getUint16(2,!0)};function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e,r){return e&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(t,e,r){return(e=m(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){y(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function m(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function U(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function O(){return a?o:(a=1,o=function(t){if(t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray)return new DataView(t.buffer,t.byteOffset,t.byteLength);if(t instanceof ArrayBuffer)return new DataView(t);throw new TypeError("Expected `data` to be an ArrayBuffer, Buffer, Int8Array, Uint8Array or Uint8ClampedArray")})}function D(){if(u)return f;u=1;var t=new WeakMap,e=new WeakMap,r=p((function r(n,i){for(var o=arguments.length,a=new Array(o>2?o-2:0),f=2;f<o;f++)a[f-2]=arguments[f];if(l(this,r),arguments.length<2)throw new TypeError("Failed to construct 'ImageData': 2 arguments required, but only ".concat(arguments.length," present."));if("object"===v(n)){if(!(n instanceof Uint8ClampedArray))throw new TypeError("Failed to construct 'ImageData': parameter 1 is not of type 'Uint8ClampedArray'.");if("number"!=typeof i||0===i)throw new Error("Failed to construct 'ImageData': The source width is zero or not a number.");if(4*(i>>>=0)>n.length)throw new Error("Failed to construct 'ImageData': The requested image size exceeds the supported range.");if(n.length%4!=0)throw new Error("Failed to construct 'ImageData': The input data length is not a multiple of 4.");if(n.length%(4*i)!=0)throw new Error("Failed to construct 'ImageData': The input data length is not a multiple of (4 * width).");if(void 0!==a[0]){if("number"!=typeof a[0]||0===a[0])throw new Error("Failed to construct 'ImageData': The source height is zero or not a number.");if(a[0]=a[0]>>>0,n.length%(4*i*a[0])!=0)throw new Error("Failed to construct 'ImageData': The input data length is not equal to (4 * width * height).")}t.set(this,i),e.set(this,void 0!==a[0]?a[0]:n.byteLength/i/4),Object.defineProperty(this,"data",{configurable:!0,enumerable:!0,value:n,writable:!1})}else{if("number"!=typeof n||0===n)throw new Error("Failed to construct 'ImageData': The source width is zero or not a number.");if(n>>>=0,"number"!=typeof i||0===i)throw new Error("Failed to construct 'ImageData': The source height is zero or not a number.");if(n*(i>>>=0)>=1<<30)throw new Error("Failed to construct 'ImageData': The requested image size exceeds the supported range.");t.set(this,n),e.set(this,i),Object.defineProperty(this,"data",{configurable:!0,enumerable:!0,value:new Uint8ClampedArray(n*i*4),writable:!1})}}));return Object.defineProperty(r.prototype,"width",{enumerable:!0,configurable:!0,get:function(){return t.get(this)}}),Object.defineProperty(r.prototype,"height",{enumerable:!0,configurable:!0,get:function(){return e.get(this)}}),f=r}function A(){if(h)return c;h=1;var t=O(),e=D();var r=function(){return p((function t(e,r,n){var i,o,a=n.width,f=n.height,u=n.colorDepth,c=n.format;if(l(this,t),this.format=c,this.offset=r,this.depth=u,this.stride=(i=a*this.depth/8,(o=i%4)?i+4-o:i),this.size=this.stride*f,this.data=e.slice(this.offset,this.offset+this.size),this.size!==this.data.byteLength)throw new Error("Truncated bitmap data")}),[{key:"get",value:function(t,e,r){var n=this.format.indexOf(r);return 1===this.depth?(this.data[e*this.stride+(t/8|0)]&1<<7-t%8*1)>>7-t%8*1:2===this.depth?(this.data[e*this.stride+(t/4|0)]&3<<6-t%4*2)>>>6-t%4*2:4===this.depth?(this.data[e*this.stride+(t/2|0)]&15<<4-t%2*4)>>>4-t%2*4:this.data[e*this.stride+t*(this.depth/8)+n]}}])}();return c=function(n){var i,o,a,f,u,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=c.width,s=void 0===h?0:h,d=c.height,g=void 0===d?0:d,l=c.icon,p=void 0!==l&&l,y=t(n);p?(i=y.getUint32(0,!0),o=y.getUint32(4,!0)/1|0,a=y.getUint32(8,!0)/2|0,f=y.getUint16(14,!0),u=y.getUint32(32,!0)):(!function(t){if(19778!==t)throw new Error("Invalid magic byte 0x".concat(t.toString(16)))}(y.getUint16(0,!0)),i=14+y.getUint32(14,!0),o=y.getUint32(18,!0),a=y.getUint32(22,!0),f=y.getUint16(28,!0),u=y.getUint32(46,!0)),0===u&&f<=8&&(u=1<<f);var w=0===o?s:o,b=0===a?g:a,m=new Uint8Array(y.buffer,y.byteOffset+i,y.byteLength-i),v=u?function(t,e){var n=e.width,i=e.height,o=e.colorDepth,a=e.colorCount,f=e.icon;if(8!==o&&4!==o&&2!==o&&1!==o)throw new Error("A color depth of ".concat(o," is not supported"));for(var u=new r(t,0,{width:a,height:1,colorDepth:32,format:"BGRA"}),c=new r(t,u.offset+u.size,{width:n,height:i,colorDepth:o,format:"C"}),h=f?new r(t,c.offset+c.size,{width:n,height:i,colorDepth:1,format:"A"}):null,s=new Uint8Array(n*i*4),d=0,g=0;g<i;g++)for(var l=0;l<n;l++){var p=c.get(l,i-g-1,"C");s[d++]=u.get(p,0,"R"),s[d++]=u.get(p,0,"G"),s[d++]=u.get(p,0,"B"),s[d++]=h&&h.get(l,i-g-1,"A")?0:255}return new Uint8ClampedArray(s.buffer,s.byteOffset,s.byteLength)}(m,{width:w,height:b,colorDepth:f,colorCount:u,icon:p}):function(t,e){var n=e.width,i=e.height,o=e.colorDepth,a=e.icon;if(32!==o&&24!==o)throw new Error("A color depth of ".concat(o," is not supported"));for(var f=new r(t,0,{width:n,height:i,colorDepth:o,format:"BGRA"}),u=24===o&&a?new r(t,f.offset+f.size,{width:n,height:i,colorDepth:1,format:"A"}):null,c=new Uint8Array(n*i*4),h=0,s=0;s<i;s++)for(var d=0;d<n;d++)c[h++]=f.get(d,i-s-1,"R"),c[h++]=f.get(d,i-s-1,"G"),c[h++]=f.get(d,i-s-1,"B"),c[h++]=32===o?f.get(d,i-s-1,"A"):u&&u.get(d,i-s-1,"A")?0:255;return new Uint8ClampedArray(c.buffer,c.byteOffset,c.byteLength)}(m,{width:w,height:b,colorDepth:f,icon:p});return Object.assign(new e(v,w,b),{colorDepth:f})},c}var E=function(){if(d)return s;d=1;var t=i?n:(i=1,n=function(t){if(t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray)return new DataView(t.buffer,t.byteOffset,t.byteLength);if(t instanceof ArrayBuffer)return new DataView(t);throw new TypeError("Expected `data` to be an ArrayBuffer, Buffer, Int8Array, Uint8Array or Uint8ClampedArray")}),e=A(),r=D();function o(t,e){return 2303741511===t.getUint32(e+0)&&218765834===t.getUint32(e+4)}function a(t,e){var r=t.getUint8(e+24),n=t.getUint8(e+25);if(0===n)return 1*r;if(2===n)return 3*r;if(3===n)return 1*r;if(4===n)return 2*r;if(6===n)return 4*r;throw new Error("Invalid PNG colorType")}function f(t,e){return t.getUint32(e+16,!1)}function u(t,e){return t.getUint32(e+20,!1)}return s=function(n){var i=t(n);if(i.byteLength<6)throw new Error("Truncated header");if(o(i,0))return[{bpp:a(i,0),data:new Uint8Array(i.buffer,i.byteOffset,i.byteLength),height:u(i,0),hotspot:null,type:"png",width:f(i,0)}];if(0!==i.getUint16(0,!0))throw new Error("Invalid magic bytes");var c=i.getUint16(2,!0);if(1!==c&&2!==c)throw new Error("Invalid image type");var h=i.getUint16(4,!0);if(i.byteLength<6+16*h)throw new Error("Truncated image list");return Array.from({length:h},(function(t,n){var h=i.getUint8(6+16*n+0),s=i.getUint8(6+16*n+1),d=i.getUint32(6+16*n+8,!0),g=i.getUint32(6+16*n+12,!0),l=2!==c?null:{x:i.getUint16(6+16*n+4,!0),y:i.getUint16(6+16*n+6,!0)};if(o(i,g))return{bpp:a(i,g),data:new Uint8Array(i.buffer,i.byteOffset+g,d),height:u(i,g),hotspot:l,type:"png",width:f(i,g)};var p=new Uint8Array(i.buffer,i.byteOffset+g,d),y=e(p,{width:h,height:s,icon:!0}),w={bpp:y.colorDepth,hotspot:l,type:"bmp"};return Object.assign(new r(y.data,y.width,y.height),w)}))}}(),F=U(E),I=function(t){return async function(t,r,n){var i=F(t);return await Promise.all(i.map((async function(t){if(r===e&&"png"===t.type)return b(b({},t),{},{buffer:t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)});if("png"===t.type){var i=await n.decode(t.data);Object.assign(t,{data:i.data,type:"bmp"})}return Object.assign(t,{buffer:await n.encode(t,r),type:r.replace("image/","")})})))}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r)},C={isICO:g,parseICO:I};t.default=C,t.isICO=g,t.parseICO=I,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ico.js.map
