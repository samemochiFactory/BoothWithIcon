chrome.runtime.onMessage.addListener((o,n,l)=>{if(o.action==="download"&&(console.log("filename:",o.filename),console.log("url:",o.url),chrome.downloads.download({url:o.url,filename:o.filename,saveAs:!0},r=>{chrome.runtime.lastError?console.error("Download error:",chrome.runtime.lastError):console.log("Download started:",r)})),o.action==="fetchItemInfo")return console.log("fetchItemInfo"),console.log(o.url),fetch(o.url).then(r=>{if(!r.ok)throw new Error(`レスポンスステータス: ${r.status}`);return r.json()}).then(r=>{l({data:r})}).catch(r=>{console.error("フェッチエラー:",r),console.error("error url:",o.url),l({error:r.message})}),!0;if(o.action==="fetchItem")return console.log("fetchItem"),console.log(o.url),fetch(o.url).then(r=>{if(console.log("レスポンスステータス:",r.status),!r.ok)throw new Error(`レスポンスステータス: ${r.status}`);return r.arrayBuffer()}).then(r=>{if(console.log("arrayBuffer:",r),!r)throw new Error("arrayBufferがnullまたはundefinedです");if(r.byteLength===0)throw new Error("取得した商品データが空です");const t=new Uint8Array(r);l({data:Array.from(t)})}).catch(r=>{console.error("フェッチエラー:",r),l({error:r.message,data:null})}),!0;if(o.action==="fetchThumbnail")return console.log("fetchThumbnail"),console.log(o.url),fetch(o.url).then(r=>{if(!r.ok)throw new Error(`レスポンスステータス: ${r.status}`);return r.arrayBuffer()}).then(r=>{l({data:Array.from(new Uint8Array(r))})}).catch(r=>{console.error("フェッチエラー:",r),l({error:r.message,data:null})}),!0;o.action==="downloadZip"&&chrome.downloads.download({url:o.blobUrl,filename:o.filename,saveAs:!0},r=>{chrome.runtime.lastError?console.error("Download failed:",chrome.runtime.lastError):console.log("Download started:",r)})});
//# sourceMappingURL=background.js.map
